/*!
 * @pixi/text-html - v3.0.2
 * Compiled Thu, 06 Oct 2022 16:17:49 UTC
 *
 * @pixi/text-html is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */import{Sprite as T}from"@pixi/sprite";import{Texture as $,settings as p,Rectangle as x,utils as c}from"@pixi/core";import{TextStyle as _}from"@pixi/text";class k extends T{constructor(e="",t={},h){h=h||document.createElement("canvas"),h.width=3,h.height=3;const o=$.from(h,{scaleMode:p.SCALE_MODE});o.orig=new x,o.trim=new x,super(o),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1;const n="http://www.w3.org/2000/svg",i=document.createElementNS(n,"svg"),r=document.createElementNS(n,"foreignObject"),a=document.createElementNS("http://www.w3.org/1999/xhtml","div");r.setAttribute("height","100%"),r.setAttribute("width","100%"),i.appendChild(r),this._domElement=a,this._svgRoot=i,this._foreignObject=r,this._image=new Image,this.canvas=h,this.context=h.getContext("2d"),this._resolution=p.RESOLUTION,this.text=e,this.style=t}updateText(e=!0){const{style:t,resolution:h}=this,o=this.canvas,n=this.context;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;let i=`
            display:inline-block;
            color:${t.fill};
            font-size: ${t.fontSize}px;
            font-family:${t.fontFamily};
            font-weight:${t.fontWeight};
            font-style:${t.fontStyle};
            font-variant:${t.fontVariant};
            letter-spacing:${t.letterSpacing}px;
            text-align:${t.align};
            padding:${t.padding}px;
        `;if(t.lineHeight&&(i+=`line-height:${t.lineHeight}px;`),t.wordWrap&&(i+=`word-wrap:${t.breakWords?"break-all":"break-word"};`,i+=`width:${t.wordWrapWidth}px;`),t.strokeThickness){let{stroke:s}=t;typeof s=="number"&&(s=c.hex2string(s)),i+=`-webkit-text-stroke-width: ${t.strokeThickness}px;`,i+=`-webkit-text-stroke-color: ${s};`,i+=`text-stroke-width: ${t.strokeThickness}px;`,i+=`text-stroke-color: ${s};`,i+="paint-order: stroke;"}if(t.dropShadow){const{dropShadowAngle:s,dropShadowDistance:g,dropShadowBlur:m,dropShadowColor:w,dropShadowAlpha:u}=t,y=Math.round(Math.cos(s)*g),f=Math.round(Math.sin(s)*g);let l=w;if(typeof l=="number"&&(l=c.hex2string(l)),l.charAt(0)==="#"&&u<1){const[v,b,S]=c.hex2rgb(parseInt(l.replace("#",""),16));l=`rgba(${v*255|0}, ${b*255|0}, ${S*255|0}, ${u})`}i+=`text-shadow: ${y}px ${f}px ${m}px ${l};`}const r=this._domElement;Object.assign(r,{innerHTML:this._text,style:i}),document.body.appendChild(r);const{width:a,height:d}=r.getBoundingClientRect();if(document.body.removeChild(r),this._foreignObject.appendChild(r),this._svgRoot.setAttribute("width",a.toString()),this._svgRoot.setAttribute("height",d.toString()),o.width=Math.ceil((Math.max(1,a)+t.padding*2)*h),o.height=Math.ceil((Math.max(1,d)+t.padding*2)*h),!this._loading){const s=this._image,g=new XMLSerializer().serializeToString(this._svgRoot);this._loading=!0,s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(g)}`,s.onload=()=>{n.scale(h,h),n.clearRect(0,0,o.width,o.height),n.drawImage(s,0,0,a,d,0,0,a,d),s.src="",s.onload=null,this._loading=!1,this.updateTexture()}}}updateTexture(){const{style:e,texture:t,resolution:h}=this,o=this.canvas,n=this.context;if(e.trim){const{width:a,height:d,data:s}=c.trimCanvas(o);s&&(o.width=a,o.height=d,n.putImageData(s,0,0))}const i=e.trim?0:e.padding,r=t.baseTexture;t.trim.width=t._frame.width=o.width/h,t.trim.height=t._frame.height=o.height/h,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-i*2,t.orig.height=t._frame.height-i*2,this._onTextureUpdate(),r.setRealSize(o.width,o.height,h),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){super.destroy(e);const t=null;this.context=null,this.canvas&&(this.canvas.width=this.canvas.height=0),this.canvas=t,this._style=t,this._svgRoot=t,this._domElement=t,this._foreignObject=t,this._image.onload=null,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this.canvas.width/this.resolution}set width(e){this.updateText(!0);const t=c.sign(this.scale.x)||1;this.scale.x=t*e/this.canvas.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this.canvas.height/this.resolution}set height(e){this.updateText(!0);const t=c.sign(this.scale.y)||1;this.scale.y=t*e/this.canvas.height/this.resolution,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof _?this._style=e:this._style=new _(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}}export{k as HTMLText};
//# sourceMappingURL=html-text.es.mjs.map
